---
language: generic
addons: { apt: { packages: [ qemu-user-static ] } }
env:
  - OS=debian   DIST=buster ARCH=i386
  - OS=debian   DIST=buster ARCH=amd64
  - OS=debian   DIST=buster ARCH=armhf
  - OS=raspbian DIST=buster ARCH=armhf
install: docker pull lpenz/${OS}-${DIST}-${ARCH}
script:
  - docker run -d --name debian -v "$PWD/..:$PWD/.." "lpenz/${OS}-${DIST}-${ARCH}" sleep 9999999999
  - docker exec -t debian /bin/bash -c "apt-get update && apt-get install -y --no-install-recommends devscripts equivs git-buildpackage"
  - docker exec -t debian /bin/bash -c "mk-build-deps -i -r --tool='apt-get -o Debug::pkgProblemResolver=yes --no-install-recommends --yes' $PWD/debian/control"
  - docker exec -t debian /bin/bash -c "cd $PWD && gbp buildpackage --git-ignore-branch -us -uc"
  - docker rm -f debian
  - sudo chown -R "$USER:$USER" ../
  - ls -l ..
deploy:
  provider: packagecloud
  username: lpenz
  repository: "$OS"
  token:
    secure: ljlCDrn+nUZBeKoyJnWyrtfBS6hNZwAUaqmdhx4nEnUN2fsE38mCVUd+OlIOKzXlqvu8NSLqfOvtPT729mHqLRhk7efos8H1hGVyTA/4tFpwxtUmY9Tm0IPeedo+1OL/gyCpiwUZxrg0zyU/HoqcdpEvHAhF+t5Y+R8R2JB0J+7CKUHTAVnbUyPO6Yj2sKPhe+6eeBYR/m6sea0fUU3/5M6Gn/8WtGpLBcw4UmyyXI8jwMgjvH29MT4w1WIObZkdI1VVIwbrfFH9WWtjCGeF6SPtYzJZkYHDPgnHEBaynA2npcLSZqybaMwK6Rca7APA4HbjMcl1E64zmhnsBWWPV/jUokjqpp/Z6jTKZ7nTa0LzoICHZ76o9wx3fTjo0SbmFMSAXZnlpECqfHOcVBvguZrFX40O1397b9ir3f5SDghIyt1bxp31tZKHEeIk1JDxu0M8mHlYvk/e6hs8jq2mTaIQ/fHA5XPmVKOGuyomrJkHjFOi5aFkC3CD2jub9EPQyxERKQ2++gwbH5LFJa3Yz6MSqodS7MLHNyaP98ymyM60Va3lE3BA+dXKFzddcuktSo4GQ+TzbzFRxQvvJgSyqKfQ0eMS1w8FNQ23/4fVhpi73ctgfCmqBfmtY5sV4C+jMRPQx//pbEtPH3yy/MAlCpiRm21X30ektfRC34oKhgA=
  dist: "$OS/$DIST"
  local-dir: ".."
  package_glob: "*.deb"
  on:
    branch: debian-debian
    tags: true
